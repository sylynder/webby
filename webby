#!/usr/bin/env php
<?php

$args = $argv;

// require_once __DIR__ . '/vendor/autoload.php';

require_once __DIR__ . '/engine/cli_functions.php';

/**
 * Function to serve webby application
 *
 * @param array $args
 * @return void
 */
function serve($args = []): void {

	$number = isset($args[3]) ? (int)$args[3] : ""; 
	$project_dir = __DIR__;
	$dir = realpath($project_dir.'/public/');
	$port = (isset($number) && is_int($number)) ? $number : 8085;
	$port = intval($port);

	if($port === 0) {
		echo Console::red("Please choose a valid port!") . "\n";
		exit();
	}

	$output =  "PHP Webserver Started for Webby \n";
	$output .= "Navigate to http://localhost:{$port} ";
	$output .= "to view your project.\nPress Ctrl+C to stop it!";" \n";
	
	echo $output . "\n";
	system('php -S localhost:'.$port.' -t '.$dir);
}

/**
 * Function to run console
 *
 * @param array $args
 * @return void
 */
function run($args):void {
	if (isset($args[2]) && $args[2] === '--port') {
		serve($args);
	} else if (isset($args[1]) && $args[1] === 'serve') {
		serve();
	} else if (isset($args[1]) && $args[1] === 'set' && @$args[2] === '--env') {
		setenv();
	} else if (isset($args[1]) && $args[1] === '--help') {
		show_help();
	} else if (!empty($args[1])) {
		execute_command($args);
	} else if (!isset($args[1])) {
		show_help();
	} else {
		no_command();
	}
}

run($args);